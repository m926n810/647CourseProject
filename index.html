<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script script="text/javascript" src="index.js"></script>
</head>
<body>
    <?php
        $db = new mysqli("mysql.eecs.ku.edu","m926n810","Yi7saine","m926n810");
        if ($db->connect_error){ 
            die("Connection failed: ".$db->connect_error);
        }

        $getbrandsquery = "SELECT BrandName FROM BRAND";

        $getmodelsquery = "SELECT * FROM MAKES";
        $getmodelsforJS = array();
        if($getmodels=$db->query($getmodelsquery)){
            while($getmodelsrows = $getmodels->fetch_assoc()){
                $getmodelsforJS[]=$getmodelsrows;
            }
        }

        $gettrimsquery = "SELECT * FROM FEATURES";
        $gettrimsforJS = array();
        if($gettrims=$db->query($gettrimsquery)){
            while($gettrimsrows = $gettrims->fetch_assoc()){
                $gettrimsforJS[]=$gettrimsrows;
            }
        }
    ?>
    <div class="top">
        <h1>2022 Cars library</h1>
    </div>
    <div class="center">

        <button type="button" class="tabheader">Search information of a vehicle:</div>
        <div class="content SearchFeatureByCarName">
            
            <div class="searchbox">
                <form action="SearchInfo.php" method="post">
                    <label>Select brand:</label>
                    <select name="carBrand" id="selectBrands" onchange="javascript: dropdownbrand(this.options[this.selectedIndex].value); document.getElementById('selectTrims').length=1;">
                        <option value='*'>All brands</option>
                        <?php if($result=$db->query($getbrandsquery)) {
                            while ($row=$result->fetch_assoc()){
                                $brand=$row['BrandName'];
                                echo "<option value='$brand'>$brand</option>";
                            }
                        }
                        ?>
                    </select>
                    <label>Select model:</label>
                    <select name="carModel" id="selectModels" onchange="javascript: dropdownmodel(this.options[this.selectedIndex].value);">
                        <option value='*'>All models</option>
                    </select>
                    <label>Select trims:</label>
                    <select name="carTrim" id="selectTrims">
                        <option value='*'>All trims</option>
                    </select>
                    <input type="submit" value="Search"></input>
                </form>
            </div>
            <div class="iframe">
                <iframe id="searchresult"></iframe>
            </div>
        </div>

        <button type="button" class="tabheader">Search a vehicle by features::</button>
        <div class="iframe">
            <iframe id="searchresult"></iframe>
        </div>
        <div class="content SearchCarbyFeatures">
            <form id="SCBF" method="post" action="SearchCarbyFeatures.php">
                <label>Body Type:</label>
                <select name="body">
                    <option value='*'>All types</option>
                    <?php if($result2=$db->query("SELECT DISTINCT BodyType FROM MODEL ORDER BY BodyType")) {
                        while ($row2=$result2->fetch_assoc()){
                            $body2=$row2['BodyType'];
                            echo "<option value='$body2'>$body2</option>";
                        }
                    }
                    ?>
                </select><br>
                <label>Safty Rating:</label>
                <select name="safe">
                    <option value='*'>Any</option>
                    <?php if($result3=$db->query("SELECT DISTINCT SafetyRating FROM MODEL ORDER BY SafetyRating")) {
                        while ($row3=$result3->fetch_assoc()){
                            $safe=$row3['SafetyRating'];
                            echo "<option value='$safe'>$safe</option>";
                        }
                    }
                    ?>
                </select><br>
                <label>Minimum Price:</label><br>
                <span class="units">$</span>
                <input type="textbox" name="minprice" id="minprice"><br>
                <label>Maximum Price:</label><br>
                <span class="units">$</span>
                <input type="textbox" name="maxprice" id="maxprice"><br>
                <label>Minimum Weight:</label><br>
                <input type="textbox" name="minweight" id="minweight">
                <span class="units">ibs</span><br>
                <label>Maximum Weight:</label><br>
                <input type="textbox" name="maxweight" id="maxweight">
                <span class="units">ibs</span><br>
                <label>Minimum Horsepower:</label><br>
                <input type="textbox" name="hrsprs">
                <span class="units">hp</span><br>
                <label>Minimum Mileage city:</label><br>
                <input type="textbox" name="gascity">
                <span class="units">mpg</span><br>
                <label>Minimum Mileage highway:</label><br>
                <input type="textbox" name="gashigh">
                <span class="units">mpg</span><br>
                
                <label>Features:</label><br>
                <input type="checkbox" name="blind" id="blind" value="yes">
                <label for="blind">Blind spots censors</label><br>
                <input type="checkbox" name="backup" id="backup" value="yes">
                <label for="backup">Backup camera</label><br>
                <input type="checkbox" name="awd" id="awd" value="yes">
                <label for="awd">All-wheel-drive option available</label><br>
                <input type="checkbox" name="GPS" id="GPS" value="yes">
                <label for="GPS">Built-in GPS</label><br>
                <input type="checkbox" name="tempseats" id="tempseats" value="yes">
                <label for="tempseats">Warm/cool seat</label><br>
                <input type="checkbox" name="sunroof" id="sunroof" value="yes">
                <label for="sunroof">Sunroof</label><br>

                <button type="button" onclick="SCBFsubmit()">Search</button>
            </form>
        </div>
    </div>
    <script language="javascript" type="text/javascript">
        
        function dropdownbrand(brand){
            var getModelsfromPhp = <?php echo json_encode($getmodelsforJS); ?>;
            document.getElementById("selectModels").length=1;
            if(brand){
                let j=1;
                for(let i=0;i<getModelsfromPhp.length;i++){
                        if(getModelsfromPhp[i].BrandName == brand){
                            document.getElementById("selectModels").options[j] = new Option(getModelsfromPhp[i].ModelName, getModelsfromPhp[i].ModelName);
                            j++;
                    }
                }
            }
        }

        function dropdownmodel(model){
            var gettrimsfromPhp = <?php echo json_encode($gettrimsforJS); ?>;
            document.getElementById("selectTrims").length=1;
            if(model){
                let j=1;
                for(let i=0;i<gettrimsfromPhp.length;i++){
                    if(gettrimsfromPhp[i].ModelName == model){
                        document.getElementById("selectTrims").options[j] = new Option(gettrimsfromPhp[i].ModelTrim, gettrimsfromPhp[i].ModelTrim);
                        j++;
                    }
                }
            }
        }

        function SCBFsubmit(){
            minweight=document.getElementById("minweight").value;
            maxweight=document.getElementById("maxweight").value;
            minprice=document.getElementById("minprice").value;
            maxprice=document.getElementById("maxprice").value;
            console.log(minweight);
            console.log(maxweight);
            console.log(minprice);
            console.log(maxprice);
            if(parseInt(minweight)>parseInt(maxweight) && minweight!="" && maxweight!=""){
                alert("Minimum weight cannot be larger than Maximum weight!");
                return;
            } 
            if(parseInt(minprice)>parseInt(maxprice) && minprice!="" && maxprice!=""){
                alert("Minimum price cannot be larger than Maximum price!");
                return;
            }
            document.getElementById("SCBF").submit();
        }

        
    </script>

    <?php $db->close();?>
</body>
</html>